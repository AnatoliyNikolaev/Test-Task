‚úÖ 1. Bash-—Å–∫—Ä–∏–ø—Ç /usr/local/bin/test_monitor.sh
bash

#!/bin/bash

PROCESS_NAME="test"
PID_FILE="/var/run/${PROCESS_NAME}.pid"
RESTART_LOG="/var/log/monitoring.log"
ERROR_LOG="/var/log/monitoring1.log"
MONITOR_URL="https://test.com/monitoring/test/api"

# –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–π PID –ø—Ä–æ—Ü–µ—Å—Å–∞
CURRENT_PID=$(pgrep -x "$PROCESS_NAME")

# –ï—Å–ª–∏ –ø—Ä–æ—Ü–µ—Å—Å –Ω–µ –∑–∞–ø—É—â–µ–Ω ‚Äî –≤—ã—Ö–æ–¥–∏–º
if [ -z "$CURRENT_PID" ]; then
    exit 0
fi

# –ü—Ä–æ–≤–µ—Ä–∫–∞, –±—ã–ª –ª–∏ –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω
if [ -f "$PID_FILE" ]; then
    LAST_PID=$(cat "$PID_FILE")
    if [ "$LAST_PID" != "$CURRENT_PID" ]; then
        echo "$(date '+%Y-%m-%d %H:%M:%S') - Process '$PROCESS_NAME' was restarted" >> "$RESTART_LOG"
    fi
fi

# –û–±–Ω–æ–≤–ª—è–µ–º PID-—Ñ–∞–π–ª
echo "$CURRENT_PID" > "$PID_FILE"

# –ü–∏–Ω–≥ –ø–æ HTTPS
HTTP_STATUS=$(curl -s -o /dev/null -w "%{http_code}" --connect-timeout 5 --max-time 10 "$MONITOR_URL")

# –õ–æ–≥–∏—Ä—É–µ–º, –µ—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä –≤–µ—Ä–Ω—É–ª –Ω–µ 2xx
if [[ ! "$HTTP_STATUS" =~ ^2[0-9]{2}$ ]]; then
    echo "$(date '+%Y-%m-%d %H:%M:%S') - Monitoring server not reachable or returned HTTP $HTTP_STATUS" >> "$ERROR_LOG"
fi
–°–¥–µ–ª–∞—Ç—å –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º:
bash

sudo chmod +x /usr/local/bin/test_monitor.sh
‚öôÔ∏è 2. systemd unit: /etc/systemd/system/test_monitor.service
ini

[Unit]
Description=Monitor 'test' process and report status
Wants=network-online.target
After=network-online.target

[Service]
Type=oneshot
ExecStart=/usr/local/bin/test_monitor.sh
‚è±Ô∏è 3. systemd timer: /etc/systemd/system/test_monitor.timer
ini

[Unit]
Description=Run test_monitor every minute

[Timer]
OnBootSec=1min
OnUnitActiveSec=1min
AccuracySec=10s
Unit=test_monitor.service

[Install]
WantedBy=timers.target
üöÄ 4. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫
bash

sudo systemctl daemon-reload
sudo systemctl enable --now test_monitor.timer
üìã –ß—Ç–æ –¥–µ–ª–∞–µ—Ç —ç—Ç–æ —Ä–µ—à–µ–Ω–∏–µ:
‚úÖ 1. –ó–∞–ø—É—Å–∫ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —Å–∏—Å—Ç–µ–º—ã	test_monitor.timer –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
‚úÖ 2. –û—Ç—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É	OnUnitActiveSec=1min –≤ —Ç–∞–π–º–µ—Ä–µ
‚úÖ 3. –ï—Å–ª–∏ –ø—Ä–æ—Ü–µ—Å—Å –∑–∞–ø—É—â–µ–Ω ‚Äî –¥–µ–ª–∞–µ—Ç HTTPS-–∑–∞–ø—Ä–æ—Å	curl –∫ https://test.com/monitoring/test/api
‚úÖ 4. –ü—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ –ø–∏—à–µ—Ç –≤ /var/log/monitoring.log	–°—Ä–∞–≤–Ω–µ–Ω–∏–µ PID
‚úÖ 5. –ï—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç ‚Äî –ø–∏—à–µ—Ç –≤ /var/log/monitoring1.log	–ü—Ä–æ–≤–µ—Ä–∫–∞ HTTP-—Å—Ç–∞—Ç—É—Å–∞
